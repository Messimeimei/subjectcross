# 数据处理说明文档

## 1. 原始数据获取

从 **Incites 数据库** 中下载各一级学科下随机抽取的 100 篇论文元数据（如下图所示），作为不同一级学科的原始样本。  

![img.png](./md/incites.png)  
![incites2.png](./md/incites2.png)

这些原始数据统一存放于：


## 2. 原始数据处理与扩充

本阶段目标：基于 DOI 获取论文的完整元数据与学科标签，并构建统一结构化数据。

### 2.1 Crossref 元数据获取

通过 **DOI + Crossref REST API** 获取论文详细元数据，包括摘要、作者机构、参考文献、出版商等。

### 2.2 OpenAlex 学科主题获取

通过 **DOI + OpenAlex API** 获取该论文在 OpenAlex 定义下的学科主题分布（topics/concepts），形成多维度学科标签。
OpenAlex 当前定义了 4516 个“学科主题”（topics），每个主题对应一个研究领域（带有 domain–field–subfield–description 层级结构）。
在 OpenAlex 的学科体系（即 hierarchical structure of domains → fields → subfields → topics）中，最顶层的 domain（领域） 目前确实只有 4 个，对应整个科学知识体系的四大板块：

Domain 名称	含义	典型领域示例
Physical Sciences	物理科学，包括数学、化学、工程、计算机科学、材料、地球科学等	Physics, Chemistry, Engineering, Computer Science, Materials Science
Life Sciences	生命科学，包括生物学、农业、生态学等	Biology, Biochemistry, Agricultural Science, Genetics
Health Sciences	医学与健康科学，包括临床医学、公共卫生、神经科学等	Medicine, Public Health, Neuroscience, Nursing
Social Sciences	社会科学与人文科学，包括经济、教育、社会学、心理学、艺术、人文等	Economics, Sociology, Psychology, Political Science, Arts, Humanities

#### OpenAlex与一级学科映射表构建
在获取了OpenAlex数据后（共计269个学科），需要与目标的117个中国一级学科做映射。采用的方式是向量相似度计算，用英文的OpenAlex学科名称与中文的117个
一级学科介绍做计算，取前5学科；然后再翻译成中文学科同样做一次计算，最后2者取并集得到了json映射表。键是269个OpenAlex学科英文名称；值是5-10个列表
存储的117个中国一级学科。后续的打分函数需要使用，参考文献的学科分布需要用到，然后论文自带的OpenAlex也要转化。

### 2.3 数据合并与结构化

整合原始 CSV 与接口返回结果，得到最终的论文数据结构。

保留以下字段：

| 来源 | 字段 | 说明 |
|------|------|------|
| 原始数据 | `DOI`, `来源`, `研究方向`, `论文标题` | Incites 下载数据 |
| Crossref | `CR_学科`, `CR_摘要`, `CR_作者和机构`, `CR_参考文献DOI`, `CR_出版商` | Crossref 元数据 |
| OpenAlex | `OpenAlex_topic_list` | OpenAlex 学科主题列表 |

---

## 3. 学科打分函数定义

数据扩充完成后，对论文所属一级学科进行多维度打分。

### 3.1 基于研究方向的打分函数

对 Incites 提供的研究方向进行均值分配：
- 默认每个研究方向权重相同；
- 研究方向数量越多，单个方向得分越低；
- 用于确定论文的学科范围边界。

### 3.2 基于词向量相似度的打分函数

#### 输入：
- **论文文本信息**：标题 + 摘要 / 作者机构 / 期刊名称  
- **学科语义描述**：117 个一级学科的学科简介  

#### 计算过程：

1. **构建学科描述向量缓存**  
   将每个学科简介分块，用本地模型 **bge-m3** 编码成向量并缓存。  

2. **构建查询向量**  
   将论文文本拼接为输入，编码为查询向量。  

3. **相似度检索**  
   计算论文向量与学科块向量的内积相似度（[-1,1]→[0,1]）。  

4. **聚合得分**  
   对每个学科取 top-k 相似度均值，作为论文与该学科的相似度分数。  

最终得到论文与 117 个学科的相似度分布，取前 10 个学科作为备选学科。  
再输入 **大模型（Qwen-Max）** 综合判断主学科与交叉学科得分。

> **可优化方向**  
> - 替换为更强多语种模型；  
> - 比较翻译与非翻译场景下的效果差异。

### 3.3 基于 OpenAlex 学科的打分函数

将 OpenAlex 提供的学科主题映射到我国一级学科体系，并按均值分配得分。  
该维度反映 OpenAlex 学术体系下的多学科覆盖情况。

### 3.4 基于参考文献的打分函数

对参考文献调用 **OpenAlex API** 获取其学科分布：  

1. 将参考文献的学科映射到一级学科；  
2. 统计出现次数；  
3. 通过 **Softmax** 归一化得到学科权重分布。  

用于反映论文在引用维度上的学科联系。

---

## 4. 批量学科打分计算

综合上述四种打分方法，对多篇论文批量计算主学科与交叉学科。

### 计算流程：

1. 读取 CSV 文件，按 `batch-size` 批量处理；  
2. 并行计算各维度打分（向量计算部分利用 GPU 加速）；  
3. 聚合结果，输出每篇论文的：
   - 主学科；
   - 交叉学科列表；
   - 各维度得分。

### 计算结果示例：

> 可在报告中展示分数分布表或可视化结果。

---

## 5. 研究要素映射

在获得学科分类结果后，通过大模型分析论文研究内容要素。

### 要素结构定义：

每篇论文生成一个 JSON 结构，包含：

1. 主学科；  
2. 七个研究要素；  
3. 每个要素包括：  
   - 涉及的交叉学科（来自学科分类结果）；  
   - 交叉等级（4 级划分，依据交叉深度与核心作用）；  
   - 判断理由；  
4. 总体交叉水平；  
5. 总体交叉水平判断理由。

### 运行机制：

- 使用 **异步并发 + API 缓存机制**；  
- 异步调用 **Qwen-Max** 进行要素识别；  
- 断点恢复以节约运行时间。

---

## 6. 运行方法

### Step 1. 获取学科补充数据
```
python -m main
```
