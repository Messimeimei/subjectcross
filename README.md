# 数据处理说明文档

## 1.原始数据获取
首先从Incites数据库中下载不同一级学科下的随机100篇论文的元数据，如下图：
![img.png](./md/incites.png)

![incites2.png](./md/incites2.png)

把这些数据作为不同一级学科的原始数据存放在data/meta_data路径下

## 2.对原始数据处理，得到用于识别学科类别的数据

### 2.1 通过doi + crossref的Rest接口获取一篇论文
基于原始数据每篇论文的doi获取该论文的更多相关信息

### 2.2 对各种信息合并，得到最终数据结构
保留原始数据中的 doi 来源 研究方向 论文标题 4个字段和crossref接口返回的CR_学科,CR_摘要,CR_作者和机构,CR_参考文献DOI, CR_出版商5个字段

## 3.打分函数定义

### 3.1 基于期刊的打分函数
维护一个期刊到学科分数的映射表，并不断更新。统计每个学科中出现的期刊，并调用大模型接口
为新出现的期刊赋予每个学科的分数。在调用时只需要传入期刊名称即可得到对应的学科分数

### 3.2 基于研究方向的打分函数
采用取均值的方式为不同的研究方向赋予学科分数，默认incites标注的学科权重是一样的，因此研究方向越多，对应的学科分数越低。

### 3.3 基于词向量相似度打分函数
论文+标题 / 作者机构 / 期刊名称 作为输入1， 每个学科的描述作为输入2，计算2者的相似度，得到单篇论文与117个学科的相似度并归一化到0-1区间，
相似度作为每个学科的得分。 

***·*** 具体计算过程如下：（一）构建学科描述的分块向量并缓存。把较长的中文学科描述按照指定长度进行分块，然后利用本地
语言模型bge-m3把这些分块编码成向量，并保存到npz缓存，方便以后检索计算。（二）构建查询向量。拼接标题和摘要 / 作者机构 / 期刊，
然后用本地语言模型bge-m3为其编码得到查询向量。（三）向量相似度检索，采用内积检索的方式，计算查询向量与每个学科的
每个分块向量的相似度[-1, 1]区间，然后映射到[0-1]区间。（四）按学科聚合，top-k取平均。将每个学科的每个分块
的相似度得分进行排序，取top-k个的平均值作为与该学科的相似度。

***·*** 待优验证化点：模块可更换更强大的多语种模型；可以考虑将2个输入翻译到同一语种与不翻译的情况做对比

### 3.4 基于参考文献的打分函数
为每个参考文献执行3.1-3.3的打分过程，得到3个来源的得分，每个得分包含了117个学科。然后基于如下权重：

{"作者机构": 0.1, "期刊": 0.3, "标题+摘要": 0.6}

合并每个学科的分数，得到每个学科的综合得分，便得到单个参考文献的学科分布情况及其分数。最后为每个学科基于所有参考文献计算全局平均值并
只保留排名前3的学科，其余学科分数置0

## 4.整体流程加速