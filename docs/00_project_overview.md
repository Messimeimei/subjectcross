# 学科交叉度大模型训练项目技术报告

- **作者**：杨鑫
- **单位**：武汉大学信息管理学院
- **版本**：v1.0
- **最后更新**：2025-11-22
- **联系方式**：3170529323@qq.com

## 目录
- [1.项目背景](#1项目背景)
- [2.数据集](#2-数据集)
  - [2.1 原始数据来源](#21-原始数据来源)
  - [2.2 基于开源接口的数据扩展](#22-基于crossref和openalex的数据扩展与清洗)
  - [2.3 基于参考文献的数据扩展](#23-对参考文献进行-openalex-维度的数据转换)
  - [2.4 多维学科打分](#24-对5个维度分别构造最终输入并基于此结合大模型得到第6个维度的输入)
  - [2.5 分类数据集构建](#25-最终数据集构建)

## 1. 项目背景
学科交叉度模型，是应教育部的学科交叉度项目要求，通过构建一个学科交叉度大模型，来提升判断一篇论文所属学科和涉及的交叉学科的准确率（因为计算一篇论文的学科交叉度需要知道这篇论文的主学科和交叉学科）。最初采用的方式是直接调用商业大模型的API接口，但是经过教育部的测试认为商业大模型API接口判断论文的主学科和交叉学科并不准确，因此本项目诞生。

为了提升判断一篇论文所属主学科和涉及的交叉学科的准确率，决定采用微调大模型的方式，通过注入论文的学科相关信息，提升该能力。

微调大模型，主要分为2个步骤，首先是SFT数据集的准备工作。如何定义一篇论文的主学科，以及如何判断这篇论文所涉及的交叉学科，并没有一个确切的方法，例如WOS中对于论文学科的判别，仅由其所在期刊的类别决定。所以构建一个训练的标准数据集非常关键，且由于论文数量巨大，靠人工进行论文学科的判别是不现实的。因此在构建SFT数据集上，决定采用半自动化标注的方式来进行。

其次是大模型的训练，如何利用SFT数据集进行微调，微调哪些模型，具体怎样进行训练和验证，如何提升训练的效果，这些都是大模型微调阶段所需要考虑的。

## 2. 数据集

### 2.1 原始数据来源
最原始的数据来源于Incites数据库，里面一共有97个标注好的一级学科，但是与117个中国一级学科重叠的部分只有94个，即原始数据中一共有94个学科的论文数据，用单个csv文件存储，每个学科都有8000-12000w条数据，数据字段如下：
```csv
入藏号,DOI,Pubmed ID,论文标题,作者,来源,研究方向,文献类型,卷,期,页,出版年,
被引频次,链接,期刊预期被引频次,类别预期被引频次,合作学科预期被引频次,期刊规范化的引文影响力,
学科规范化的引文影响力,按主题、年份、文献类型和合作类型调整后的规范化引文影响力。,合作类型,学科领域百分位,期刊影响因子
```
原始数据位于 `/subjectcross/data/01meta_data`下，一共是96个文件夹，说明有一个不相关的学科数据已经被删除了，形如：
```yaml
01meta_data:
  0101 Philosophy:
    - xxx.csv
  0201 Theoretical Economics:
    - xxx.csv
```

### 2.2 基于CrossRef和Openalex的数据扩展与清洗
第一步手工下载的原始数据一共是96个学科，每个学科一个csv文件，每个学科文件包含大量不相关字段，缺少后续需要的相关字段，因此需要对数据进行扩清洗和扩展。清洗即 **统一数据字段**， **去重不相关字段**；扩展即 **补充新的字段**。除此之外，为了后续补充数据方便，防止重复获取相同论文数据，这一步还支持增量获取，通过比较当前数据（可能有所增加）和原始数据（上一轮完整流程走完后的数据）的新增论文 DOI，完成新增论文的字段扩充工作，并保存到下一个阶段的当前数据中。

1. 首先是对原始数据的字段进行清洗和去重，最终将所有论文的4个字段统一为：`DOI, 来源, 研究方向, 论文标题`。示例数据如下：
```yaml
DOi:
  10.1111/zygo.12831
来源:
  ZYGON
研究方向:
  0101 Philosophy; 0303 Sociology
论文标题:
  "ARTIFICIAL INTELLIGENCE AS A TESTING GROUND FOR KEY THEOLOGICAL QUESTIONS with Andrea Vestrucci, ""Introduction: Five Steps Towards a Religion-AI Dialogue""; Lluis Oviedo, ""AI and Theology: Looking for a Positive-But Not Uncritical-Reception""; Christoph Benzmuller, ""Symbolic AI and Godel's Ontological Argument""; Sara Lumbreras, ""Lessons from the Quest for Artificial Consciousness: The Emergence Criterion, Insight-Oriented AI, and Imago Dei""; Marius Dorobantu, ""Artificial Intelligence as a Testing Ground for Key Theological Questions""; and Andrea Vestrucci, ""Artificial Intelligence and God's Existence: Intersecting Theology and Computation."""
```

2. 然后定义2个扩充函数，分别是对单篇论文的 DOI 完成 CrossRef 和 Openalex的数据字段补充，新增数据字段分别是`CR_摘要，CR_作者和机构，CR_参考文献DOI` 和 `OpenAlex_field_list，OpenAlex_subfield_list`。示例数据如下：
```yaml
CR_摘要:
  Engagement with artificial intelligence (AI) can be highly beneficial for theology. This article maps the landscape of the various ways such engagement can occur. It begins by outlining the opportunities and limitations of computational theology before diving into speculative territory by imagining how robot theologians might think of divine revelation. The topic of AI and imago Dei is then reviewed, illustrating several ways AI can inform theological anthropology. The article concludes with a more speculative take on the possible implications of AI for divine infinity, incarnation, theodicy, and demonic intelligence.
CR_作者和机构:
  [{"name": "Marius Dorobantu", "affiliation": ["Zygon: Journal of Religion and Science"]}]
CR_参考文献DOI:
  []
```

```yaml
OpenAlex_field_lis:
  ['Social Sciences']
OpenAlex_subfield_list:
  ['Political Science and International Relations', 'Sociology and Political Science']
```

3. Openalex字段映射，在获取了`OpenAlex_field_list，OpenAlex_subfield_list`2列数据后，需要基于先前由大模型判断得到的学科映射表，将这2列涉及的学科映射成中国学科和对应的分数，存储在新的字段`OpenAlex_map_subjects`中。例如：

```python
[[('0303 社会学', 0.7395), ('0714 统计学', 0.7394), ('0503 新闻传播学', 0.7379), ('0602 中国史', 0.7298), ('0304 民族学', 0.7297)], [('0302 政治学', 0.7764), ('1204 公共管理学', 0.7587)], [('0302 政治学', 0.7685), ('0303 社会学', 0.7605)]]
```

其中学科映射表是将中国的117个学科名称和 Openalex 的 field 和 subfield由大模型进行映射，其中field得到5个学科的分数；subfield得到2个学科的分数。一共有3个映射表可选：
- **deepseek_map.json**
- **chatgpt_map.json**
- **openalex_to_cn_disciplines_merged.json** (由bge-m3根据向量相似度计算得到)

4. 增量补充数据。分别打开当前新增了的数据和上次运行后的原始数据，取 DOI 求差集，对这些差集的 DOI 列执行数据扩充操作，得到了目标学科文件需要的数据，即`DOI,来源,研究方向,论文标题,CR_摘要,CR_作者和机构,CR_参考文献DOI,OpenAlex_field_list,OpenAlex_subfield_list,OpenAlex_map_subjects`,然后直接追加到目标学科csv文件的df中，再做基于 DOI 的去重操作，最后保存到原来的csv文件中。

这一阶段的数据位于`/subjectcross/data/02crossref_data`下，形如:
```yaml
02crossref_data:
  - 0101 Philosophy.csv
  - 0201 Theoretical Economics.csv
```

### 2.3 对参考文献进行 Openalex 维度的数据转换
这一阶段只针对参考文献维度，将其由单纯的论文 DOI 转换成 Openalex维度的数据，即为每篇论文（代码中可以限制，只获取20个参考文献的数据）执行第二步中获取 Openalex数据的操作，每篇论文都包含 field 和 subfield 的学科得到字段`Ref_OpenAlex_topics`，示例数据如下：

```yaml
Ref_OpenAlex_topics:
  [[['Social Sciences', 'Arts and Humanities'], ['Political Science and International Relations', 'Philosophy', 'Sociology and Political Science']], [['Social Sciences', 'Arts and Humanities'], ['Sociology and Political Science', 'Safety Research', 'Philosophy']], [['Social Sciences'], ['Sociology and Political Science']], [['Social Sciences', 'Arts and Humanities'], ['Sociology and Political Science', 'Safety Research', 'Philosophy']], [['Social Sciences', 'Arts and Humanities'], ['Health', 'Philosophy', 'Sociology and Political Science']], [['Arts and Humanities'], ['Philosophy']], [['Social Sciences', 'Physics and Astronomy'], ['Statistical and Nonlinear Physics', 'Communication', 'Sociology and Political Science']], [['Social Sciences', 'Psychology'], ['Developmental and Educational Psychology', 'Gender Studies', 'Sociology and Political Science']], [['Social Sciences', 'Neuroscience', 'Arts and Humanities'], ['Sociology and Political Science', 'Cognitive Neuroscience', 'Philosophy']], [['Social Sciences', 'Neuroscience', 'Arts and Humanities'], ['Sociology and Political Science', 'Cognitive Neuroscience', 'Philosophy']], [['Computer Science'], ['Artificial Intelligence']], [['Neuroscience', 'Health Professions', 'Arts and Humanities'], ['General Health Professions', 'Cognitive Neuroscience', 'Philosophy']], [['Arts and Humanities'], ['Philosophy']], [['Computer Science'], ['Artificial Intelligence']], [[], []], [['Social Sciences', 'Physics and Astronomy', 'Arts and Humanities'], ['Statistical and Nonlinear Physics', 'Safety Research', 'Philosophy']], [['Social Sciences', 'Psychology', 'Arts and Humanities'], ['Education', 'Developmental and Educational Psychology', 'Philosophy']], [['Neuroscience', 'Psychology', 'Arts and Humanities'], ['Cognitive Neuroscience', 'Experimental and Cognitive Psychology', 'Philosophy']], [['Social Sciences', 'Arts and Humanities'], ['Political Science and International Relations', 'Philosophy', 'Sociology and Political Science']], [['Social Sciences', 'Arts and Humanities'], ['Sociology and Political Science', 'History and Philosophy of Science', 'Philosophy']]]
```

再为每篇论文的 Openalex学科进行学科映射，得到字段`Ref_OpenAlex_map_subjects`，示例数据如下：

```yaml
Ref_OpenAlex_map_subjects:
  [[['0302 政治学', 0.7764], ['0101 哲学', 0.772], ['0303 社会学', 0.7605], ['1204 公共管理学', 0.7587], ['0714 统计学', 0.7394], ['0503 新闻传播学', 0.7379], ['0602 中国史', 0.7298], ['0304 民族学', 0.7297], ['0702 物理学', 0.7246], ['1301 艺术学', 0.685], ['0501 中国语言文学', 0.684], ['0502 外国语言文学', 0.6758], ['1405 智能科学与技术', 0.6679]], [['0837 安全科学与工程', 0.7723], ['0101 哲学', 0.772], ['0302 政治学', 0.7685], ['0303 社会学', 0.7605], ['0839 网络空间安全', 0.7531], ['0714 统计学', 0.7394], ['0503 新闻传播学', 0.7379], ['0602 中国史', 0.7298], ['0304 民族学', 0.7297], ['0702 物理学', 0.7246], ['1301 艺术学', 0.685], ['0501 中国语言文学', 0.684], ['0502 外国语言文学', 0.6758], ['1405 智能科学与技术', 0.6679]], [['0302 政治学', 0.7685], ['0303 社会学', 0.7605], ['0714 统计学', 0.7394], ['0503 新闻传播学', 0.7379], ['0602 中国史', 0.7298], ['0304 民族学', 0.7297]], [['0837 安全科学与工程', 0.7723], ['0101 哲学', 0.772], ['0302 政治学', 0.7685], ['0303 社会学', 0.7605], ['0839 网络空间安全', 0.7531], ['0714 统计学', 0.7394], ['0503 新闻传播学', 0.7379], ['0602 中国史', 0.7298], ['0304 民族学', 0.7297], ['0702 物理学', 0.7246], ['1301 艺术学', 0.685], ['0501 中国语言文学', 0.684], ['0502 外国语言文学', 0.6758], ['1405 智能科学与技术', 0.6679]], [['0101 哲学', 0.772], ['0302 政治学', 0.7685], ['0303 社会学', 0.7605], ['1004 公共卫生与预防医学', 0.7421], ['0714 统计学', 0.7394], ['0503 新闻传播学', 0.7379], ['1002 临床医学', 0.7304], ['0602 中国史', 0.7298], ['0304 民族学', 0.7297], ['0702 物理学', 0.7246], ['1301 艺术学', 0.685], ['0501 中国语言文学', 0.684], ['0502 外国语言文学', 0.6758], ['1405 智能科学与技术', 0.6679]], [['0101 哲学', 0.772], ['0702 物理学', 0.7246], ['1301 艺术学', 0.685], ['0501 中国语言文学', 0.684], ['0502 外国语言文学', 0.6758], ['1405 智能科学与技术', 0.6679], ['0503 新闻传播学', 0.667]], [['0302 政治学', 0.7685], ['0303 社会学', 0.7605], ['0503 新闻传播学', 0.7528], ['0810 信息与通信工程', 0.7451], ['0809 电子科学与技术', 0.7443], ['0801 力学', 0.7421], ['0714 统计学', 0.7394], ['0704 天文学', 0.7308], ['0602 中国史', 0.7298], ['0304 民族学', 0.7297], ['0702 物理学', 0.7214], ['0708 地球物理学', 0.7121], ['1404 遥感科学与技术', 0.7093], ['0706 大气科学', 0.7071]], [['0402 心理学', 0.7693], ['0302 政治学', 0.7685], ['0303 社会学', 0.7605], ['0401 教育学', 0.7489], ['0821 纺织科学与工程', 0.7467], ['0502 外国语言文学', 0.741], ['0714 统计学', 0.7394], ['0503 新闻传播学', 0.7379], ['1011 护理学', 0.731], ['0602 中国史', 0.7298], ['0304 民族学', 0.7297], ['1202 工商管理学', 0.7276]], [['0101 哲学', 0.772], ['0302 政治学', 0.7685], ['0303 社会学', 0.7605], ['0714 统计学', 0.7394], ['0503 新闻传播学', 0.7379], ['0710 生物学', 0.7369], ['0402 心理学', 0.7327], ['0602 中国史', 0.7298], ['0304 民族学', 0.7297], ['1405 智能科学与技术', 0.7293], ['0811 控制科学与工程', 0.7277], ['0702 物理学', 0.7246], ['1002 临床医学', 0.7245], ['1301 艺术学', 0.685], ['0501 中国语言文学', 0.684], ['0502 外国语言文学', 0.6758]], [['0101 哲学', 0.772], ['0302 政治学', 0.7685], ['0303 社会学', 0.7605], ['0714 统计学', 0.7394], ['0503 新闻传播学', 0.7379], ['0710 生物学', 0.7369], ['0402 心理学', 0.7327], ['0602 中国史', 0.7298], ['0304 民族学', 0.7297], ['1405 智能科学与技术', 0.7293], ['0811 控制科学与工程', 0.7277], ['0702 物理学', 0.7246], ['1002 临床医学', 0.7245], ['1301 艺术学', 0.685], ['0501 中国语言文学', 0.684], ['0502 外国语言文学', 0.6758]], [['0812 计算机科学与技术', 0.7697], ['0839 网络空间安全', 0.7566], ['0811 控制科学与工程', 0.7551], ['0835 软件工程', 0.7476], ['1405 智能科学与技术', 0.7393]], [['0101 哲学', 0.772], ['0710 生物学', 0.7369], ['0402 心理学', 0.7327], ['1405 智能科学与技术', 0.7293], ['0811 控制科学与工程', 0.7277], ['1004 公共卫生与预防医学', 0.7259], ['0702 物理学', 0.7246], ['1002 临床医学', 0.7245], ['1009 特种医学', 0.7169], ['1003 口腔医学', 0.7153], ['1011 护理学', 0.711], ['1301 艺术学', 0.685], ['0501 中国语言文学', 0.684], ['0502 外国语言文学', 0.6758], ['0503 新闻传播学', 0.667]], [['0101 哲学', 0.772], ['0702 物理学', 0.7246], ['1301 艺术学', 0.685], ['0501 中国语言文学', 0.684], ['0502 外国语言文学', 0.6758], ['1405 智能科学与技术', 0.6679], ['0503 新闻传播学', 0.667]], [['0812 计算机科学与技术', 0.7697], ['0839 网络空间安全', 0.7566], ['0811 控制科学与工程', 0.7551], ['0835 软件工程', 0.7476], ['1405 智能科学与技术', 0.7393]], [], [['0837 安全科学与工程', 0.7723], ['0101 哲学', 0.772], ['0839 网络空间安全', 0.7531], ['0809 电子科学与技术', 0.7443], ['0801 力学', 0.7421], ['0303 社会学', 0.7395], ['0714 统计学', 0.7394], ['0503 新闻传播学', 0.7379], ['0704 天文学', 0.7308], ['0602 中国史', 0.7298], ['0304 民族学', 0.7297], ['0702 物理学', 0.7246], ['0708 地球物理学', 0.7121], ['1404 遥感科学与技术', 0.7093], ['0706 大气科学', 0.7071], ['1301 艺术学', 0.685], ['0501 中国语言文学', 0.684], ['0502 外国语言文学', 0.6758], ['1405 智能科学与技术', 0.6679]], [['0101 哲学', 0.772], ['0402 心理学', 0.7693], ['0401 教育学', 0.765], ['0705 地理学', 0.7447], ['0303 社会学', 0.7395], ['0714 统计学', 0.7394], ['0503 新闻传播学', 0.7379], ['1011 护理学', 0.731], ['0602 中国史', 0.7298], ['0304 民族学', 0.7297], ['1202 工商管理学', 0.7276], ['0702 物理学', 0.7246], ['1301 艺术学', 0.685], ['0501 中国语言文学', 0.684], ['0502 外国语言文学', 0.6758], ['1405 智能科学与技术', 0.6679]], [['0101 哲学', 0.772], ['0402 心理学', 0.7693], ['0303 社会学', 0.7389], ['0710 生物学', 0.7369], ['0714 统计学', 0.7326], ['1011 护理学', 0.731], ['1405 智能科学与技术', 0.7293], ['0811 控制科学与工程', 0.7277], ['1202 工商管理学', 0.7276], ['0702 物理学', 0.7246], ['1002 临床医学', 0.7245], ['1301 艺术学', 0.685], ['0501 中国语言文学', 0.684], ['0502 外国语言文学', 0.6758], ['0503 新闻传播学', 0.667]], [['0302 政治学', 0.7764], ['0101 哲学', 0.772], ['0303 社会学', 0.7605], ['1204 公共管理学', 0.7587], ['0714 统计学', 0.7394], ['0503 新闻传播学', 0.7379], ['0602 中国史', 0.7298], ['0304 民族学', 0.7297], ['0702 物理学', 0.7246], ['1301 艺术学', 0.685], ['0501 中国语言文学', 0.684], ['0502 外国语言文学', 0.6758], ['1405 智能科学与技术', 0.6679]], [['0101 哲学', 0.772], ['0302 政治学', 0.7685], ['0303 社会学', 0.7605], ['0712 科学技术史', 0.7544], ['0714 统计学', 0.7394], ['0503 新闻传播学', 0.7379], ['0602 中国史', 0.7298], ['0304 民族学', 0.7297], ['0702 物理学', 0.7246], ['1301 艺术学', 0.685], ['0501 中国语言文学', 0.684], ['0502 外国语言文学', 0.6758], ['1405 智能科学与技术', 0.6679]]]
```

这一步同样是采取增量的操作，读取当前数据和原始数据，并求差集得到新增的 DOI，然后对新增 DOI 的参考文献doi执行上述2个操作，最后得到的完整数据字段包括：

`DOI,来源,研究方向,论文标题,CR_摘要,CR_作者和机构,CR_参考文献DOI,OpenAlex_field_list,OpenAlex_subfield_list,OpenAlex_map_subjects,Ref_OpenAlex_topics,Ref_OpenAlex_map_subjects`

相比上面一步多了2列。这一阶段的数据位于`/subjectcross/data/03openalex_data`下，形如:
```yaml
03openalex_data:
  - 0101 Philosophy.csv
  - 0201 Theoretical Economics.csv
```

### 2.4 对5个维度分别构造最终输入，并基于此结合大模型得到第6个维度的输入
当前拥有的数据字段包括：

```csv
DOI,来源,研究方向,论文标题,CR_摘要,CR_作者和机构,CR_参考文献DOI,OpenAlex_field_list,OpenAlex_subfield_list,OpenAlex_map_subjects,Ref_OpenAlex_topics,Ref_OpenAlex_map_subjects
```

但是这些字段对于判断论文的主学科和交叉学科并没有帮助，既然是6维加权融合计算，那么就需要为每个维度的学科赋予一定的分数，因此在这一步需要做的就是为 `研究方向,论文标题,CR_摘要,CR_作者和机构,OpenAlex_map_subjects,Ref_OpenAlex_map_subjects` 这5个维度中包含的学科，赋予一个最终的分数。

- **研究方向学科分数-list_incites_direction**
  原始的`研究方向`字段数据如下：

  ```
  0101 Philosophy; 0303 Sociology; 0503 Journalism and Communication; 1004 Public Health and Preventive Medicine
  ```

  考虑到incites标注的学科权重一样，因此这个字段的学科分数可以直接采用取平均值的方式，即每个学科的分数均为 1/N，N是学科的总数。得到分数如下：

  ```
  [('0101 哲学', 0.25), ('0303 社会学', 0.25), ('0503 新闻传播学', 0.25), ('1004 公共卫生与预防医学', 0.25)]
  ```

- **Openalex学科分数-list_openalex**
  原始的`OpenAlex_map_subjects`字段数据如下：

  ```
  [[('0202 应用经济学', 0.766), ('0714 统计学', 0.7639), ('0201 理论经济学', 0.7634), ('1202 工商管理学', 0.7449), ('0701 数学', 0.7423)], [('1002 临床医学', 0.7333), ('1007 药学', 0.7307), ('1001 基础医学', 0.7301), ('1008 中药学', 0.7257), ('1005 中医学', 0.7236)], [('0303 社会学', 0.7395), ('0714 统计学', 0.7394), ('0503 新闻传播学', 0.7379), ('0602 中国史', 0.7298), ('0304 民族学', 0.7297)], [('0202 应用经济学', 0.7539), ('0201 理论经济学', 0.7475)], [('0302 政治学', 0.7685), ('0303 社会学', 0.7605)], [('1004 公共卫生与预防医学', 0.7253), ('1009 特种医学', 0.7027)]]
  ```

  考虑到在第一步做学科映射的时候，采用的映射表不够准确，因此在这一步先将 `OpenAlex_field_list,OpenAlex_subfield_list` 2个字段重新映射成分数更加准确的`OpenAlex_map_subjects`字段，经过重新映射后结构还是不变，只是涉及的学科和对应的分数可能会发生变化。

  然后在这个字段的基础上，计算每个学科的分数。具体计算方式是：统计每个学科的分数总和，除以每个学科的出现次数（未出现则分数直接为0），即 score_sum / count，这样就有了所有学科的分数排序，然后取topk=5进行保留，得到分数如下：

  ```
  [('1002 临床医学', 0.0708), ('0202 应用经济学', 0.0691), ('1001 基础医学', 0.0674), ('0303 社会学', 0.0674), ('0201 理论经济学', 0.0657)]
  ```

- **参考文献学科分数-list_ref**
  原始的`Ref_OpenAlex_map_subjects`字段数据如下：

  ```
  [[['0202 应用经济学', 0.95], ['0201 理论经济学', 0.9], ['1202 工商管理学', 0.8], ['1201 管理科学与工程', 0.75], ['1203 农林经济管理', 0.7], ['1011 护理学', 0.9], ['1002 临床医学', 0.85], ['1004 公共卫生与预防医学', 0.8], ['1003 口腔医学', 0.75], ['1005 中医学', 0.7], ['0303 社会学', 0.9], ['0302 政治学', 0.85], ['0301 法学', 0.8], ['0401 教育学', 0.75], ['1204 公共管理学', 0.7], ['0202 应用经济学', 0.9], ['0201 理论经济学', 0.85], ['1007 药学', 0.9], ['1008 中药学', 0.85], ['0301 法学', 0.95], ['0302 政治学', 0.7]], [['0202 应用经济学', 0.95], ['0201 理论经济学', 0.9], ['1202 工商管理学', 0.8], ['1201 管理科学与工程', 0.75], ['1203 农林经济管理', 0.7], ['1011 护理学', 0.9], ['1002 临床医学', 0.85], ['1004 公共卫生与预防医学', 0.8], ['1003 口腔医学', 0.75], ['1005 中医学', 0.7], ['0202 应用经济学', 0.9], ['0201 理论经济学', 0.85], ['1011 护理学', 0.9], ['1002 临床医学', 0.8]], [['0202 应用经济学', 0.95], ['0201 理论经济学', 0.9], ['1202 工商管理学', 0.8], ['1201 管理科学与工程', 0.75], ['1203 农林经济管理', 0.7], ['1011 护理学', 0.9], ['1002 临床医学', 0.85], ['1004 公共卫生与预防医学', 0.8], ['1003 口腔医学', 0.75], ['1005 中医学', 0.7], ['0202 应用经济学', 0.9], ['0201 理论经济学', 0.85], ['1011 护理学', 0.9], ['1002 临床医学', 0.8]], [['0303 社会学', 0.9], ['0302 政治学', 0.85], ['0301 法学', 0.8], ['0401 教育学', 0.75], ['1204 公共管理学', 0.7], ['0303 社会学', 0.9], ['0302 政治学', 0.9]], [['1011 护理学', 0.9], ['1002 临床医学', 0.85], ['1004 公共卫生与预防医学', 0.8], ['1003 口腔医学', 0.75], ['1005 中医学', 0.7], ['0101 哲学', 0.9], ['0501 中国语言文学', 0.85], ['0502 外国语言文学', 0.8], ['0602 中国史', 0.75], ['1301 艺术学', 0.7], ['0303 社会学', 0.9], ['0302 政治学', 0.85], ['0301 法学', 0.8], ['0401 教育学', 0.75], ['1204 公共管理学', 0.7], ['0303 社会学', 0.9], ['0302 政治学', 0.9], ['1011 护理学', 0.9], ['1002 临床医学', 0.8], ['0101 哲学', 0.95], ['0301 法学', 0.6]], [['0202 应用经济学', 0.95], ['0201 理论经济学', 0.9], ['1202 工商管理学', 0.8], ['1201 管理科学与工程', 0.75], ['1203 农林经济管理', 0.7], ['1002 临床医学', 0.95], ['1001 基础医学', 0.9], ['1004 公共卫生与预防医学', 0.85], ['1007 药学', 0.8], ['1011 护理学', 0.75], ['0202 应用经济学', 0.9], ['0201 理论经济学', 0.85], ['1004 公共卫生与预防医学', 0.9], ['0830 环境科学与工程', 0.8]], [['0202 应用经济学', 0.95], ['0201 理论经济学', 0.9], ['1202 工商管理学', 0.8], ['1201 管理科学与工程', 0.75], ['1203 农林经济管理', 0.7], ['1201 管理科学与工程', 0.9], ['0701 数学', 0.85], ['0714 统计学', 0.8], ['0402 心理学', 0.75], ['1202 工商管理学', 0.7], ['0701 数学', 0.95], ['0714 统计学', 0.8], ['1201 管理科学与工程', 0.75], ['0811 控制科学与工程', 0.7], ['0702 物理学', 0.65], ['0714 统计学', 0.9], ['0701 数学', 0.85], ['0202 应用经济学', 0.9], ['0201 理论经济学', 0.85], ['0714 统计学', 0.9], ['0701 数学', 0.85]], [['0202 应用经济学', 0.95], ['0201 理论经济学', 0.9], ['1202 工商管理学', 0.8], ['1201 管理科学与工程', 0.75], ['1203 农林经济管理', 0.7], ['1002 临床医学', 0.95], ['1001 基础医学', 0.9], ['1004 公共卫生与预防医学', 0.85], ['1007 药学', 0.8], ['1011 护理学', 0.75], ['1001 基础医学', 0.9], ['1002 临床医学', 0.8], ['0202 应用经济学', 0.9], ['0201 理论经济学', 0.85], ['1002 临床医学', 0.9], ['1001 基础医学', 0.8]], [['0202 应用经济学', 0.95], ['0201 理论经济学', 0.9], ['1202 工商管理学', 0.8], ['1201 管理科学与工程', 0.75], ['1203 农林经济管理', 0.7], ['1011 护理学', 0.9], ['1002 临床医学', 0.85], ['1004 公共卫生与预防医学', 0.8], ['1003 口腔医学', 0.75], ['1005 中医学', 0.7], ['1002 临床医学', 0.95], ['1001 基础医学', 0.9], ['1004 公共卫生与预防医学', 0.85], ['1007 药学', 0.8], ['1011 护理学', 0.75], ['0202 应用经济学', 0.9], ['0201 理论经济学', 0.85], ['1011 护理学', 0.9], ['1002 临床医学', 0.8], ['1004 公共卫生与预防医学', 0.9], ['0830 环境科学与工程', 0.8]], [['0202 应用经济学', 0.95], ['0201 理论经济学', 0.9], ['1202 工商管理学', 0.8], ['1201 管理科学与工程', 0.75], ['1203 农林经济管理', 0.7], ['1202 工商管理学', 0.9], ['1201 管理科学与工程', 0.85], ['0202 应用经济学', 0.8], ['1204 公共管理学', 0.75], ['1203 农林经济管理', 0.7], ['1202 工商管理学', 0.9], ['1204 公共管理学', 0.8], ['0202 应用经济学', 0.9], ['0201 理论经济学', 0.85], ['1201 管理科学与工程', 0.9], ['1202 工商管理学', 0.8]]]
  ```

  同样需要先将 `Ref_OpenAlex_topics` 这个字段重新映射成分数更加准确的`Ref_OpenAlex_map_subjects`字段，经过重新映射后结构还是不变，只是涉及的学科和对应的分数可能会发生变化。

  然后在这个字段的基础上，计算每个学科的分数。具体计算方式是：首先把列表展开，成为1个列表，里面的元素是（学科， 分数）。然后不区分是哪篇参考文献，就统计每个学科在所有参考论文中出现的次数（未出现则分数直接为0）和总的分数，即 score_sum / count，这样就有了所有学科的分数排序，然后取topk=10进行保留，因为参考文献范围更广，所以比Openalex的学科数量更多。得到分数如下：

  ```
  [('0101 哲学', 0.0388), ('0202 应用经济学', 0.0385), ('0303 社会学', 0.0379), ('1001 基础医学', 0.0371), ('0201 理论经济学', 0.0369), ('0701 数学', 0.0369), ('1011 护理学', 0.0365), ('1002 临床医学', 0.0363), ('1008 中药学', 0.036), ('0501 中国语言文学', 0.036)]
  ```

- **作者机构学科分数-list_author_aff_qwen**
  原始的`CR_作者和机构`字段如下：

  ```json
  [
    { 
      "name": "Annika M Svensson", 
      "affiliation": ["Länssjukhuset i Kalmar, Kalmar, Sweden"]
    }, 
    { 
      "name": "Fabrice Jotterand", 
      "affiliation": ["Medical College of Wisconsin, Milwaukee, Wisconsin, USA", "Universal of Basel, Basel, Switzerland"]
    }
  ]
  ```

  考虑到作者机构一般就是大学或者具体到学院，而单独的大学是无法判断出其学科的，因此只能依靠学院名称来判断，同时每个学院最多代表1-2个学科，所以采用大模型进行判断，首先判断该机构是大学还是具体学院，如果是大学则没有学科分数，如果是学院，则由大模型从117个学科中选取出2个学科并赋予等级，转换成分数。最后同样统一化学科分数并进行softmax操作，取topk个学科保存，得到分数如下：

  ```csv
  [('1204 公共管理学', 0.5355), ('0302 政治学', 0.4645)]
  ```

- **标题摘要学科分数-list_title_abs**
  原始的`论文标题,CR_摘要`2个字段是字符串，为了从这2个字段中判断出论文所属的主学科和交叉学科，可以采用词向量相似度计算的方法，即将 标题+摘要 的内容与每个学科的简介内容进行相似度计算并排序，就可以得到主学科和交叉学科。分数即相似度。
  目前方法包括4种:
  - 第一种是基于传统的词向量模型bge-m3计算相似度;
  - 第二种是由商业大模型 API 进行判断并给出不同的等级（需要注意的是不能让大模型直接给出分数吗，是没有意义的，让大模型判断类别更加合适）；
  - 第三种是前两种方法的融合，即首先由传统词向量进行判断出topk=5的学科，然后由大模型在此基础上进一步判断得到0-5个学科及其分数，然后将2者分数进行融合：如果学科在2个维度都出现，则取平均分；否则只保留词向量的分数
  - 第四种也是前两种方法的融合，由传统词向量模型进行判断，但是大模型不是在此基础上，而是单独根据标题+摘要从117个学科里面选出5个学科，然后再进行融合。
  
  之前的方式是保留 `list_title_abs_qwen,list_title_abs_ave,list_title_abs_merged,list_title_abs_bge` 这4个字段，然后取第3种方法`list_title_abs_merged`作为最终使用的字段，得到分数如下：

  ```yaml
  [('0303 社会学', 0.8197), ('1012 法医学', 0.7589), ('1009 特种医学', 0.7547), ('1011 护理学', 0.7547), ('1002 临床医学', 0.7328)]
  ```

  但是后续更新，决定只采用词向量相似度计算的方式，但是采用Qwen3-Embedding-0.6B-向量化模型来进行。因此得到新的04input_data文件夹中的csv字段如下：
  
  ```csv
  DOI,来源,研究方向,论文标题,CR_摘要,CR_作者和机构,CR_参考文献DOI,OpenAlex_field_list,OpenAlex_subfield_list,OpenAlex_map_subjects,Ref_OpenAlex_topics,Ref_OpenAlex_map_subjects,list_incites_direction,list_title_abs,list_author_aff_qwen,list_openalex,list_ref
  ```

  其中最后5列就是最后用于单篇论文主学科和涉及交叉学科判定数据集构建的输入。这次的更新是单独编写函数进行更新，单独对已有的 04input_data 文件夹下的学科csv文件进行更新，不影响完整流程。

- **大模型汇总分数-list_llm**
  这是计划新加的第六个字段，通过将前面5个字段的分数交给商业大模型API，由大模型重新判断并给出每个学科的最终分数，再进行排序取topk=5。

最后得到的完整数据字段包括：
`DOI,来源,研究方向,论文标题,CR_摘要,CR_作者和机构,CR_参考文献DOI,OpenAlex_field_list,OpenAlex_subfield_list,OpenAlex_map_subjects,Ref_OpenAlex_topics,Ref_OpenAlex_map_subjects`

与前面一步多了5列字段`list_incites_direction,list_title_abs,list_author_aff_qwen,list_openalex,list_ref`,根据最新的方法，还会加入`list_llm`这个字段作为第六个字段的分数。这一阶段的数据位于`/subjectcross/data/04input_data`下，形如:
```yaml
04input_data:
  - 0101 Philosophy.csv
  - 0201 Theoretical Economics.csv
```

### 2.5 最终数据集构建

（1）论文分类数据集的构建
目前已有的数据结果保存在 `04input_data` 文件夹中，在这一阶段所需要做的就是基于上述得到的5-6列字段所包含的学科分数，为每个学科得到最终的总分数，然后选取主学科和动态选取交叉学科。实现这一目标一共有两种方式：
- 第一种就是通过人工赋予每个维度一定权重的方式，然后计算每个学科的多维度加权求和分数，得到每个学科的最终分数并进行排序。
  - 具体来说，就是人为的为每个维度赋予一定的权重，例如incites这个维度是人工标注得到的分数，其权重应该更高。所有维度的权重和应该为1，为一篇论文的每个学科计算其多维加权和分数，w1·x1 + w2·x2 + w3·x3 + w4·x4 + w5·x5 = score, 对每个学科的分数进行排序，取排名第一个的学科作为主学科。而交叉学科则是基于整个学科的统计学特征动态选取：计算学科分数与分数之间的差并用列表存储gaps[],然后计算分数差的均值与标准差，使用阈值 `thr = mean_gap + 0.5 × std_gap` 来作为一个分数断点，在这个断点之后的学科分数都不需要保存，而在这个阈值之前的学科分数，再进行筛选；即从第二个学科开始，其与前一个学科的分数差距不能超过50%，否则直接到此结束。
- 第二种方式是在上述数据的基础上，由专家为每条论文标注主学科和涉及的交叉学科。然后将每条论文的数据拆分成3分类的数据。具体方式是统计论文中出现的所有学科，然后看每个学科在每个维度上是否出现，出现则记录该维度分数，不出现则分数为0，得到一条数据格式为 `([s1, s2, s3, s4, s5, s6], 0|1|2)`,其中的 [s1, s2, s3, s4, s5, s6] 是单个学科的输入，0表示什么学科都不属于；1表示交叉学科；2表示主学科。然后采用机器学习的方式，学习每个维度的权重，实现输入学科的分数即可得到其类别，然后应用到每篇论文上，得到论文中每个学科的类别，并进行划分，直接得到这篇论文的主学科和交叉学科
（2）微调数据集的构建
微调数据集的构建格式，取决于需要微调的大模型。